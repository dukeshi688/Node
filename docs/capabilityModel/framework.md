# 架构能力模型


## 系统架构能力

### 基本理论

#### 扩展性设计
指可通过加机器线性提高系统处理能力，承担更高的流量和并发

提升系统可扩展性的核心，就是降低系统各个模块和组件之间的耦合，耦合程度越低，各个模块和组件的复用可能性就越大，系统的可扩展性也会越好。

#### 可用性设计
指一个系统在大部分时间都是可用的，可以提供服务的，即使发生硬件故障或者系统升级的时候，服务仍然是可用的

#### 可靠性设计
指在给定的时间内，特定的环境下软件无错运行的概率

系统是否可靠，主要体现在当系统发生结构变化或增加新功能时，依靠架构的有效设计，仍然能保证系统正常运行

#### 一致性设计
指在分布式系统中，多个节点中数据的值是一致的

一致性分为强一致性、弱一致性、最终一致性

强一致性：当更新操作完成之后，任何多个后续进程或者线程的访问都会返回最新的更新过的值，这种对用户是最友好的，就是上一次用户写什么，下一次就保证读到什么，根据CAP理论，这种实现需要牺牲可用性

弱一致性：系统并不保证连续进程或者线程的访问都会返回最新的更新过的值。系统在数据写入成功之后，不承诺立即可以读到最新写入的值，也不会具体的承诺多久之后可以读到

最终一致性：弱一致性的特定形式，系统在保证没有后续更新的前提下，最终返回上一次更新操作的值，在没有故障发生的情况下，不一致窗口的时间主要受通信延迟，系统负载和复制副本的个数影响

#### 负载均衡设计
指将特定的业务（网络服务、网络流量等）分担给多个服务器或网络设备，从而提高了业务处理能力，保证了业务的高可用性

负载均衡就是将大量的数据处理操作分摊到多个操作单元进行执行，用来解决互联网分布式系统的大流量、高并发和高可用问题

#### 过载保护设计
指在高并发、大流量的访问系统时，采取适当的系统过载保护策略，不让系统崩溃

调用的远程服务或者资源由于某种原因无法使用时，如果没有过载保护，就会导致请求的资源阻塞在服务器上等待从而耗尽系统或者服务器资源。很多时候刚开始系统可能只是出现了局部的、小规模的故障，然后由于种种原因，故障影响的范围越来越大，最终导致了全局性的后果

#### 灾难恢复设计
指发生故障时，系统还能继续运行

备份系统（机房内的本地备份）+异地容灾系统（异地备份），能够避免主生产中心由于地震、火灾或其他灾害造成的数据丢失，这是一个较为理想化的容灾系统一体化解决方案，能够狠大程度上避免各种可能的错误

### 协议设计

#### 二进制协议
指对一个二进制文件进行读取，将里面的二进制数据按照存储协议转换为我们需要的数据结构，供存储或其他使用

特点：传输高效、方便解析，场景单一

#### 文本协议
指基于TCP/IP通信协议来传输数据（HTML文件，图片文件，数据集等）

特点：直观、描述性强，容易理解，便于调试，解析复杂

如果想要高效传输，比如物联网中收集传感器数据，使用二级制协议
如果想要便于调试，比如使用telnet就能当客户端用，可使用文本协议
如果命令较少，比如即时通讯软件，可使用文本协议
二进制数据的难理解性，自然加密，对数据安全有一定要求的可以使用二进制协议

### 接入层架构设计

#### DNS轮询
指将解析请求按照A记录的顺序，随机分配到不同的IP上

一般DNS轮询用于访问量较大的网站，由于一台服务器无法承载，所以准备了多台服务器组成集群做负载均衡，这些服务器并不在一个地方，这时就需要添加多条A记录，把一个域名指向多个IP

#### 动静态分离
指将动态请求和静态请求区分访问

#### 静态化
指将动态的内容转换为静态的html

#### 反向代理
指以代理服务器来接收internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端

正向代理：正向代理的过程，隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代理来请求，例vpn

反向代理：反向代理隐藏了真实的服务端，请求发送到反向代理服务器，它会帮我们把请求转发到真实的服务器去，nginx就是性能非常好的反向代理服务器，用来做负载均衡

#### LVS
LVS是Linux Virtual Server的缩写，即Linux虚拟服务器，是一个虚拟的服务器集群系统

软负载均衡

#### F5
F5是负载均衡产品的一个品牌

硬负载均衡

#### CDN
CDN的全称是内容分发网络，其目的是通过现有的Internet中增加一层新的网络架构，将网站的内容发布到最接近用户的网络“边缘”，使用户可以就近取得所需的内容，提高用户访问网站的响应速度

### 逻辑层架构设计

#### 连接池
指初始化时创建一定数量的对象，需要时直接从池中取出一个空闲对象，用完后并不直接释放调对象，而是再放到对象池中以方便下一次对象请求可以直接复用

连接池的作用是为了提高性能，使用连接池省略了每次创建连接和销毁连接的过程

#### 串行化技术
指把一个对象变成01串，然后在需要的地方重新恢复成对象，可以将对象保存在文件，然后再读出，将一个对象通过网络传输

串行化和序列化都是一样的，都对应英文中的Serializable。一个对象随着创建而存在，随着程序结束而结束，如果需要保存一个对象的状态，那就将对象的状态写入byte流存储起来，也从其他地方将byte流读取出来，重新构造一个新的对象，这种机制允许将对象通过网络进行传播，并且可以随时把对象持久化到数据库、文件系统中，总之，序列化就是将一个对象的状态保存起来，而反序列化就是将已经保存的流对象恢复成原来的对象

#### 影子Master架构
指服务正常时，它只是单点master的一个影子，在master出现故障时，shadow-master会自动变成master，继续提供服务

master工作时，shadow-master只备份，master出现故障时，shadow-master会自动变成master，继续提供服务，shadow-master能够解决高可用的问题，并且故障转移是自动的，不需要人工介入

#### 批量写入
批量执行写语句，性能更优，数据库操作避免频繁进行事务提交

#### 配置中心
一种统一管理各种应用配置的基础服务组件，在分布式服务架构中，当系统从一个单体应用，被拆分成分布式系统上的一个个服务节点后，配置文件也必须跟着迁移，这样配置就分散了，不仅如此，分散中还包含着冗余，而配置中心就是将配置从各应用中剥离出来，对配置进行统一管理，应用自身不需要自己去管理配置

配置中心的服务流程如下：
1、用户在配置中心发布、更新配置信息
2、服务A和服务B及时得到配置更新通知，从配置中心获取配置

总的来说，配置中心就是一种统一管理各种应用配置的基础服务组件

#### 去中心化
在一个分布有众多节点的系统中，每个节点都有高度自治的特征。节点之间彼此可以自由连接，形成新的连接单元。任何一个节点都可能成为阶段性的中心，但不具备强制性的中心控制功能。节点与节点之间的影响，会通过网络而形成非线性因果关系。这种开放式、扁平化、平等性的系统现象或结构，就是去中心化

相反的，中心化，在一个系统中有一个信息的汇聚点，决策汇聚点，这个汇聚点一旦不工作，整个系统就无法正常运转

#### 通讯机制

##### 同步与异步
同步，是所有的操作都做完，才返回给用户结果；异步，不用等所有操作都做完，就响应用户的请求

##### MQ
消息队列，用途：解耦、异步、削峰

##### Cron
计划任务，指任务在约定的时间执行已经计划好的工作

##### RMI
远程方法调用

##### RPC
远程过程调用协议

RPC与RMI的区别：
1、方法调用方式不同
RMI是通过在客户端的Stub对象作为远程接口进行远程方法的调用。每个远程方法都具有方法签名。如果一个方法在服务器上执行，但是没有相匹配的签名被添加到这个远程接口（stub）上，那么这个新方法就不能被RMI客户方所调用

RPC中是通过网络服务协议向远程主机发送请求，请求包含了一个参数集和一个文本值，通常形成“classname.methodname（参数集）”的形式。RPC远程主机就去搜索与之相匹配的类和方法，找到后就执行方法并把结果编码，通过网络协议返回

2、使用语言范围不同
RMI只适用于Java；
RPC是网络服务协议，与操作系统和语言无关；

### 数据库层架构设计

#### 缓存优化

#### DAO&ORM

#### 双主架构

#### 主从同步

#### 读写分离



## 工程架构能力